<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Résultats Régression</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="text-center">Résultats de la Régression</h2>

    <div class="text-center mt-4">
      <img src="data:image/png;base64,{{ graph_url }}" class="img-fluid rounded shadow">
    </div>

    <div class="mt-5 text-center">
      <h5>Performance du modèle Random Forest</h5>
      <ul class="list-group w-50 mx-auto">
        <li class="list-group-item">MAE : {{ result['MAE'] }}</li>
        <li class="list-group-item">MSE : {{ result['MSE'] }}</li>
        <li class="list-group-item">R² : {{ result['R²'] }}</li>
      </ul>
    </div>

    <div class="text-center mt-4">
      <a href="/" class="btn btn-outline-primary">Retour à l'accueil</a>
    </div>
  </div>
  <!-- Supprimer le deuxième script dupliqué et corriger l'export CSV -->
  <script>
    // Graphique de distribution des durées de vol
    document.addEventListener('DOMContentLoaded', function() {
        const ctx1 = document.getElementById('durationChart').getContext('2d');
        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['0-1h', '1-2h', '2-3h', '3-4h', '4h+'],
                datasets: [{
                    label: 'Nombre de vols',
                    data: [12, 19, 3, 5, 2],
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Distribution des durées de vol'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Graphique de comparaison durée réelle/prédite
        const ctx2 = document.getElementById('comparisonChart').getContext('2d');
        new Chart(ctx2, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Durée réelle vs prédite',
                    data: [
                        {x: 1.5, y: 1.6},
                        {x: 2.0, y: 2.1},
                        // Ajoutez vos données ici
                    ],
                    backgroundColor: 'rgba(255, 99, 132, 0.5)'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Comparaison durée réelle/prédite'
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Durée réelle (heures)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Durée prédite (heures)'
                        }
                    }
                }
            }
        });
    });

    // Fonction d'export des données
    function exportToCSV() {
        const headers = ["ID Vol", "Compagnie", "Aéroport Départ", "Aéroport Arrivée", "Durée Réelle", "Durée Prédite"];
        const rows = [
            ["AF123", "Air France", "CDG", "JFK", "7.5", "7.3"],
            // Ajoutez vos données ici
        ];
        
        let csvContent = "data:text/csv;charset=utf-8," 
            + headers.join(",") + "\n" 
            + rows.map(e => e.join(",")).join("\n");
        
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "resultats_regression.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>
</body>
</html>
